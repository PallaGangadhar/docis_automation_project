{% extends 'base.html' %}
{% block title %}index{% endblock %}
{% block content %}

<div class="has-bg-img">
    <div class="bg-img bg-cover">
        <div class="page-content page_content_scroll">
            <div class="container-fluid px-6">

                <!-- First Row: Line Chart & Pie Chart -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="card shadow-lg">
                            <div class="card-header bg-info text-white text-center fw-bold">Regression Over Time (Last
                                10 Days)</div>
                            <div class="card-body">
                                <figure class="highcharts-figure">
                                    <div id="line_chart"></div>
                                </figure>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card shadow-lg">
                            <div class="card-header bg-info text-white text-center fw-bold">Regression Breakdown</div>
                            <div class="card-body">
                                <figure class="highcharts-figure">
                                    <div id="regression_pie_chart"></div>
                                </figure>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Second Row: Bar Chart -->
                <div class="row mt-3">
                    <div class="col-lg-12">
                        <div class="card shadow-lg">
                            <div class="card-header bg-info text-white text-center fw-bold">Regression Summary (Last 10
                                Days)</div>
                            <div class="card-body">
                                {% if error_message %}
                                <h5 class="text-center text-danger">End Date should be greater than or equal to From
                                    Date.</h5>
                                {% else %}
                                <figure class="highcharts-figure">
                                    <div id="bar_chart" style="height: 350px;"></div>
                                </figure>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="row mt-3">
                    <form id="filter_graph" method="GET" action="/" class="row g-2 align-items-end">
                        <div class="col-lg-2">
                            <label for="from_date_val" class="form-label">From Date</label>
                            <div class="input-group">
                                <input class="form-control" type="text" name="from_date" id="from_date_val"
                                    placeholder="From Date" required  autocomplete="off" />
                                <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                            </div>
                        </div>
                        <div class="col-lg-2">
                            <label for="to_date_val" class="form-label">To Date</label>
                            <div class="input-group">
                                <input class="form-control" type="text" name="to_date" id="to_date_val"
                                    placeholder="To Date" required required autocomplete="off" />
                                <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                            </div>
                        </div>
                        <div class="col-lg-3 d-flex gap-2">
                            <button type="submit" class="btn btn-primary mt-4">Search</button>
                            <button type="button" class="btn btn-secondary mt-4" onclick="clear_filter()">Clear</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Highcharts Scripts -->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/data.js"></script>
<script src="https://code.highcharts.com/modules/drilldown.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script src="../static/assets/libs/jquery/jquery.min.js"></script>

<script>
    try {
        var regression_date_graph = JSON.parse('{{ regression_date_graph|tojson }}');
        var pie_chart = JSON.parse('{{ pie_chart|tojson }}');


        var reg_data = [];
        var reg_date = [];

        for (var i = 0; i < regression_date_graph['data'].length; i++) {
            reg_data.push(regression_date_graph['data'][i]['count']);
            reg_date.push(regression_date_graph['data'][i]['date']);
        }

        // Bar Chart
        Highcharts.chart('bar_chart', {
            chart: { type: 'column', borderRadius: 8 },
            //title: { text: 'Regression Summary (Last 10 Days)' },
            title: { text: '' },
            xAxis: { categories: reg_date, crosshair: true },
            yAxis: { min: 0, title: { text: 'Count' } },
            series: [{ name: 'Regression', data: reg_data }],
            exporting: { enabled: false },
            credits: { enabled: false }
        });

        // Line Chart
        Highcharts.chart('line_chart', {
            chart: { type: 'spline', borderRadius: 8 },
            title: { text: '' },
            // title: { text: 'Regression Over Time (Last 10 Days)' },
            xAxis: { categories: reg_date },
            yAxis: { title: { text: 'Count' } },
            series: [{ name: 'Regression', data: reg_data }],
            exporting: { enabled: false },
            credits: { enabled: false }
        });

        Highcharts.chart('regression_pie_chart', {
            chart: { type: 'pie', borderRadius: 8 },
            title: { text: '' },
            //'Regression Breakdown' },
            tooltip: {
                // pointFormat: '{series.name}: <b>{point.y}</b> ({point.percentage:.2f}%)'
                pointFormat: '{point.percentage:.2f}%'
            },
            series: [{
                // name: 'Share', 
                data: pie_chart
            }],
            exporting: { enabled: false },
            credits: { enabled: false }
        });
    } catch (err) { console.error(err); }
</script>



<script>

</script>

{% endblock %}